<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta http-equiv="content-type" content="text/html; charset=utf-8">
<title>ISU build server</title>
<link rel="stylesheet" type="text/css" href="index.css">
<script src="index.js"></script>
<script>

var allTests = [];



function materialize(data) {
	id_indiv.innerHTML = "";
	allTests = [];
	for(var i = 0; i <data.length; i++) {
		data[i].title = dec(data[i].title);
		data[i].id = dec(data[i].id);
		data[i].zadani = dec(data[i].zadani);
		data[i].init = dec(data[i].init);
		var dataI = new testI(data[i]);
		allTests[allTests.length] = dataI;
		id_indiv.appendChild(dataI.getElement());
	}
}

function loadRemoteTests() {
	var cbFail = function(data) {
		id_loader.innerHTML = dec(data);
		id_loader.classList.remove("loader");
		id_loader.classList.add("loader_error");
	};
	var cbOk = function(data) {
		var deco = decode(data);
		if(deco!==false){
			var jsn = JSON.parse(deco);
			if(jsn!==false){
				if(jsn.code === 0) {
					materialize(jsn.tests);		
				} else {
					cbFail(dec("Nepodařilo se nahrát testy: <br />" + jsn.result));
				}
				return;
			}
		}
		cbFail(dec("Nepodařilo se dekódovat testy"));
	};
	var data = {"action":"COLLECT"}
	var txtEnc = "q=" + encode(JSON.stringify(data));
	async(txtEnc, cbOk, cbFail);
}


function aload() {
	loadRemoteTests();
}

</script>
<style>
.loader {
	position: fixed;
	left:calc(50% - 120px);
	top:calc(50% - 80px);
	width: 120px;
	border: 5px solid green;
	padding: 80px;
}

.loader_error {
	position: fixed;
	left:calc(50% - 240px);
	top:calc(50% - 80px);
	width: 240px;
	border: 5px solid red;
	padding: 80px;
}

</style>
</head>
<body onload="aload();">
	<div id=id_indiv class="txtTest">
	<div class="loader" id=id_loader>
		Nahrávám testy...
	</div>
		<!-- 
		<div class="txtWrap">
			<textarea class="txtASm" id=id_asm>


		</textarea>
			<div class="pnlControls">
				<Button id="id_submit">Otestovat řešení</Button>
			</div>
		</div>
		<div class="txtDescr">
			<div class="txtDescrName">Popis</div>
			<span class="txtDescrTxt"> Tohle je test </span>
		</div>
		<div class="txtDescr">
			<div class="txtDescrName txtDescrNameSolution">Řešení</div>
			<span class="txtDescrSolutionLog"> Spouštím sadu testů...</span>
		</div>

		<div id="id_result"></div>
		 -->
	</div>

</body>
</html>