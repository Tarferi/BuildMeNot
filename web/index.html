<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>ISU build server</title>
<script>

	function async(data, callback) {
		var http = new XMLHttpRequest();
		var url = window.location.href+"test";
		http.open("POST", url, true);
		http.onreadystatechange = function(e) {
			if(e.target.readyState == 4) {
				callback(http.responseText);
			}
		};
		http.send(data);
	}

	function toHex(c) {
		if (c >= 0 && c <= 9) {
			return (c + '0'.charCodeAt(0));
		} else if (c >= 10 && c <= 15) {
			return ((c - 10) + 'a'.charCodeAt(0));
		} else {
			return false;
		}
	}

	function encode(bdata) {
		result = [];
		for (var i = 0; i < bdata.length; i++) {
			var c = bdata.charCodeAt(i);
			var c1 = toHex(c >> 4);
			var c2 = toHex(c & 0b1111);
			if (c1 === false || c2 === false) {
				return false;
			}
			result[i * 2] = String.fromCharCode(c1);
			result[(i * 2) + 1] = String.fromCharCode(c2);
		}
		return result.join("");

	}

	function fromHex(c) {
		if (c >= '0'.charCodeAt(0) && c <= '9'.charCodeAt(0)) {
			return c - '0'.charCodeAt(0);
		} else if (c >= 'A'.charCodeAt(0) && c <= 'F'.charCodeAt(0)) {
			return 10 + c - 'A';
		} else if (c >= 'a'.charCodeAt(0) && c <= 'f'.charCodeAt(0)) {
			return 10 + c - 'a'.charCodeAt(0);
		} else {
			return false;
		}
	}

	function decode(data) {
		sb = "";
		for (var i = 0; i < data.length / 2; i++) {
			var c1 = data.charCodeAt(i * 2);
			var c2 = data.charCodeAt((i * 2) + 1);
			c1 = fromHex(c1);
			c2 = fromHex(c2);
			if (c1 === false || c2 === false) {
				return false;
			}
			var x = (c1 << 4) | c2;
			sb += String.fromCharCode(x);
		}
		return sb;
	}

	function submit() {
		var txt = id_asm.innerHTML
		var data = {"asm":txt}
		var txtEnc = "q=" + encode(JSON.stringify(data));
		async(txtEnc, function(response) {
			console.log(response);
			deco = decode(response)
			if(deco!==false) {
				var obj = JSON.parse(deco);
				if(obj!==false){
					console.log(obj);
				}
			}
		});
	}

	function aload() {
		id_submit.addEventListener("click", submit);
	}
</script>
</head>
<body onload="aload();">
	<div id=id_indiv>
		<textarea id=id_asm style="width: 630px; height: 300px;">
%include "rw32-2018.inc"

section .data
	sMessage db "Hello World!",EOL,0

section .text

CMAIN:
	push ebp
	mov ebp,esp

	mov esi,sMessage
	call WriteString

	; zde muzete psat vas kod

	pop ebp
	ret

		</textarea>
		<Button id="id_submit">Submit</Button>
		<div id="id_result"></div>
	</div>

</body>
</html>